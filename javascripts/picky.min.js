Array.prototype.index=function(a){for(var b=0,k=this.length;b<k;b++)if(this[b]==a)return b;return null};Array.prototype.include=function(a){return this.index(a)!==null};Array.prototype.remove=function(a){this.splice(a,1);return this};Array.prototype.compare=function(a){return this.join("")==a.join("")};Array.prototype.each=function(a){for(var b=0,k=this.length;b<k;b++)a(b,this[b]);return this};var dictionary={common:{join:{de:"und",fr:"et",it:"e",en:"and",ch:"und"},"with":{de:"mit",fr:"avec",it:"con",en:"with",ch:"mit"},of:{de:"von",fr:"de",it:"di",en:"of",ch:"vo"},to:{de:"bis",fr:"\u00e0",it:"alla",en:"to",ch:"bis"}},results:{addination:{more:{de:"Weitere Resultate",fr:"Autres r\u00e9sultats",it:"Altri risultati",en:"More results",ch:"Mee Resultaat"}},header:{de:"Ergebnisse",fr:"R\u00e9sultats",it:"Risultati",en:"Results",ch:"Erg\u00e4bnis"}}},t=function(a){for(var b=PickyI18n.locale||
"en",k=a.split(".").concat(b),g=dictionary,h=0,m=k.length;h<m;h++){g=g[k[h]];if(g==undefined){g="Translation missing: "+a+"."+b;break}}return g};function Allocation(a,b,k,g,h,m){var o=this;this.type=a;this.weight=b;this.count=k;this.combination=g;this.ids=h||[];this.entries=this.rendered=m||[];this.isType=function(u){return u==o.type}}function Allocations(a){this.allocations=[];for(var b=0,k=a.length;b<k;b++){var g=a[b];this.allocations.push(new Allocation(g[0],g[1],g[2],g[3],g[4],g[5]))}this.length=this.allocations.length;this.remove=function(h){this.allocations.splice(h,1)};this.each=function(h){this.allocations.each(h)}}
function PickyData(a){var b=a.total,k=a.duration,g=a.offset,h=new Allocations(a.allocations||[]);this.original_hash=a;this.total=b;this.duration=k;this.offset=g;this.allocations=h;this.renderedAmount=function(){var m=0;h.each(function(o,u){m+=u.rendered.length});return m};this.isEmpty=function(){return b==0}};var PickyView=function(a,b){var k=b.showResultsLimit||10,g=b.input,h=b.reset,m=b.button,o=b.counter,u=b.dashboard,y=b.moreSelector,s=b.results,w=b.noResults,z=new PickyAddination(this,s),j=new PickyAllocationsCloud(this,b),e=new PickyResultsRenderer(z,b),d=function(){h.fadeTo(166,1)},n=function(){j.hide();s.empty();w.hide()},i=function(f){g.val(f);h.fadeTo(166,0);p("empty");o.empty();n()};this.reset=i;var q=function(){return g.val()};this.text=q;var r=function(f){o.text(f);f>0&&f<=5&&o.fadeTo("fast",
0.5).fadeTo("fast",1)},c=function(f){if(f.isEmpty())return"none";if(f.total>k&&f.allocations.length>1)return"support";return"ok"},p=function(f){u.attr("class","dashboard "+f)};this.insert=function(f){g.val(f);g.select()};this.fullResultsCallback=function(f){p(c(f));if(f.isEmpty()){n();r(0);w.show();d()}else if(f.total>k&&f.allocations.length>1){n();d();j.show(f);r(f.total)}else if(f.offset==0){n();r(f.total);e.render(s,f);s.show();d();g.focus()}else{var v=$(y).position().top;z.remove();e.render(s,
f);$("body").animate({scrollTop:v-12},500)}};this.liveResultsCallback=function(f){p(c(f));r(f.total)};this.allocationChosen=function(f){f=f.data.query;a.insert(f);a.allocationChosen(f)};this.addinationClicked=function(f){a.addinationClicked(q(),f)};(function(){g.keyup(function(f){if(q()==""){i();a.searchTextCleared()}else d();a.searchTextEntered(q(),f)});o.click(function(){a.searchButtonClicked(q())});m.click(function(){a.searchButtonClicked(q())});h.click(function(){i("");a.clearButtonClicked();
g.focus()})})();g.focus()};var PickyBackend=function(a){var b=function(k,g,h){var m=h||{};m=$.extend({query:k},h);$.getJSON(a,m,function(o){g&&g(new PickyData(o))})};this.search=function(k,g,h,m){b(k,function(o){g&&g(m,o)},h)}},LiveBackend=function(a){var b=a.live||alert("A live backend path must be provided."),k=new PickyBackend(b);this.search=function(g,h,m,o){o=o||{};latestRequestTimestamp=new Date;o.live=latestRequestTimestamp;m=$.extend({ids:a.liveResults||0,offset:0},m);k.search(g,function(u,y){if(!u.live||u.live==latestRequestTimestamp)h&&
h(y)},m,o)}},FullBackend=function(a){var b=a.full||alert("A full backend path must be provided."),k=new PickyBackend(b);this.search=function(g,h,m,o){o=o||{};latestRequestTimestamp=new Date;o.full=latestRequestTimestamp;m=$.extend({ids:a.fullResults||20,offset:0},m);k.search(g,function(u,y){if(!u.full||u.full==latestRequestTimestamp)h&&h(y)},m,o)}};var PickyController=function(a){var b=new PickyView(this,a),k=a.backends,g=a.beforeInsert||function(){},h=a.before||function(){},m=a.success||function(){},o=a.after||function(){},u=a.liveRendered||false,y=a.liveSearchInterval||180,s,w=function(c){return(c=c&&c.match(/q=([^&]+)/))&&decodeURIComponent(c[1]).replace(/\+/g," ").replace(/#/g,"")||""};this.extractQuery=w;var z=function(){var c=window.History&&window.History.getState();return w(c&&c.url)};this.lastFullQuery=z;var j=function(c,p,f,v){var x=
h(p,v);if(x!=undefined)p=x;s=[c,p,f,v];x=p;if(x!=z()){x=x==""?"":"?q="+escape(x).replace(/\*/g,"%2A");window.History&&window.History.getState()&&window.History.pushState&&window.History.pushState(null,null,x)}if(p=="")b.reset();else(c=k[c])&&c.search(p,f,v)};this.resend=function(){s&&j.apply(this,s)};var e=function(c,p){c=m(c,p)||c;b.fullResultsCallback(c);o(c,p)},d=function(c,p){clearInterval(i);j("full",c,e,p||{})};a=function(c,p){c=m(c,p)||c;b.liveResultsCallback(c);o(c,p)};var n=u?e:a,i,q=function(){var c=
b.text();j("live",c,n,{});clearInterval(i)};i=setInterval(q,y);clearInterval(i);var r=function(c,p,f){var v=g(c);if(v!=undefined)c=v;b.insert(c);f&&d(c,p)};this.insert=r;this.clearButtonClicked=function(){clearInterval(i)};this.searchTextCleared=function(){clearInterval(i)};this.searchTextEntered=function(c,p){if($.inArray(p.keyCode,[0,8,13,32,46,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90])>-1)if(p.keyCode==13)d(c);else{clearInterval(i);
i=setInterval(q,y)}};this.searchButtonClicked=function(c){d(c)};this.allocationChosen=function(c){d(c)};this.addinationClicked=function(c,p){d(c,{offset:p.data.offset})};window.History&&window.History.Adapter.bind(window,"statechange",function(){var c=window.History.getState();c=w(c.url);c!=undefined&&c!=(s&&s.length>1&&s[1])&&r(c,{},true)})};var PickyI18n={},PickyClient=function(a){PickyI18n.locale=$("html").attr("lang").split("-")[0]||"en";a.locale=a.locale||PickyI18n.locale;a.qualifiers=a.qualifiers||{};a.explanations=a.explanations||{};a.choices=a.choices||{};a.explanation_delimiters={ch:"und",de:"und",en:"and",fr:"et",it:"e"};var b=a.backends;if(b){b.live||alert("Both a full and live backend must be provided.");b.full||alert("Both a full and live backend must be provided.")}else a.backends={live:new LiveBackend(a),full:new FullBackend(a)};
b=a.enclosingSelector||"#picky";a.input=$(a.inputSelector||b+" input.query");a.reset=$(a.resetSelector||b+" div.reset");a.button=$(a.buttonSelector||b+" input.search_button");a.counter=$(a.counterSelector||b+" div.status");a.dashboard=$(a.dashboardSelector||b+" .dashboard");a.results=$(a.resultsSelector||b+" div.results");a.noResults=$(a.noResultsSelector||b+" .no_results");a.moreSelector=a.moreSelector||b+" div.results div.addination:last";a.allocations=$(a.allocationsSelector||b+" .allocations");
a.shownAllocations=a.allocations.find(".shown");a.showMoreAllocations=a.allocations.find(".more");a.hiddenAllocations=a.allocations.find(".hidden");a.maxSuggestions=a.maxSuggestions||3;a.results=$(a.resultsSelector||b+" div.results");a.resultsDivider=a.resultsDivider||"";a.nonPartial=a.nonPartial||[];a.wrapResults=a.wrapResults||'<ol class="results"></ol>';var k=a.controller&&new a.controller(a)||new PickyController(a);var g=this.insert=function(h,m,o){k.insert(h,m||{},o||true)};this.resend=k.resend;
this.insertFromURL=function(h){if(h)g(h);else(h=k.lastFullQuery())&&g(h)}};var PickyAddination=function(a,b){this.remove=function(){b.find(".addination").remove()};this.render=function(k){var g=k.total,h,m=k.renderedAmount();h=k.offset+m;m=h+m;k=k.total;if(k<m)m=k;h={offset:h,start:h+1,end:m};if(h.offset<g){g=$("<div class='addination'>"+t("results.addination.more")+"</div>");g.bind("click",{offset:h.offset},a.addinationClicked);return g}else return""}};var PickyResultsRenderer=function(a,b){var k=b.locale,g=b.explanations||{},h=b.explanation_delimiters||{},m=b.resultsDivider,o=b.wrapResults,u=b.nonPartial,y=function(e){var d=e[e.length-1];if(d===undefined)return[];e=e.slice(0,e.length-1);if(e==[])e=[e];if(!u.include(d[0]))if(d[1].match(/[^\*~]$/))d[1]+="*";e.push(d);return e};this.asteriskifyLastToken=y;var s=function(e){for(var d=g[k]||{},n=[],i,q=0,r=e.length;q<r;q++){i=e[q];var c=i[0];c=d[c]||c;n.push([c,i[1]])}return n};this.explainCategory=
s;var w=function(e,d){return[e.replace(/([\w\s\u00c4\u00e4\u00d6\u00f6\u00dc\u00fc\u00e9\u00e8\u00e0\,]+)/,"<strong>$1</strong>"),d].join(" ")};this.strongify=w;var z=function(e,d){var n=h[k],i="",q=[],r=[];s(y(d)).each(function(c,p){var f=p[0],v=p[1];v=v.replace(/[\w,]+:(.+)/,"$1");if(i==""||f==i){q.push(v);i=f}else{var x=w(i,q.join(" "));q=[];q.push(v);i=f;r.push(x)}});r.push(w(i,q.join(" ")));r=r.join(" "+n+" ");return r='<span class="explanation">'+e+" "+r+"</span>"};this.explain=z;var j=function(e,
d){var n='<div class="header">';n+=z(d.type,d.combination);if(e.offset>0)n+='<div class="tothetop"><a href="#" onclick="javascript:$(\'body\').animate({scrollTop: 0}, 500);">&uarr;</a></div>';n+="</div>";return n};this.renderHeader=j;this.render=function(e,d){d.allocations.each(function(n,i){if(i.entries.length>0){e.append(j(d,i)).append(i.entries.join(m));e.children("li").wrapAll(o)}});e.append(a.render(d))}};function AllocationRenderer(a){function b(j){var e={},d={},n=[],i;i=0;for(l=j.length;i<l;i++){var q=j[i][0];if(q in e){e[q]=e[q]+" "+j[i][1];n.push(i)}else{e[q]=j[i][1];d[i]=q}}for(i in d)j[i][1]=e[d[i]];for(i=n.length-1;i>=0;i--)j.remove(n[i]);return j}function k(j){var e=[];j.each(function(d){e.push("%"+(d+1)+"$s")});return e.join(" ")}function g(j){if(j.length==0)return"";var e=j=b(j);e.sort(function(p,f){return p[0]<f[0]?-1:1});for(var d=[],n=0,i=e.length;n<i;n++)d.push(e[n][0]);var q=d.length==
1,r=w[d.join(",")]||(w[d]=k(d));if(typeof r==="string"){w[d]={format:r};r=w[d]}var c=r.format;j.each(function(p,f){var v=f[0],x=f[2];if(r.filter)x=r.filter(x);v=y[v]||v;if(q&&!(r&&r.ignoreSingle))return c=x+"&nbsp;("+v+")";x=x.replace(/[\w,]+:(.+)/,"$1");c=c.replace(RegExp("%"+(p+1)+"\\$s","g"),x)});return c}function h(j){for(var e=[],d=0,n=s.length;d<n;d++)e.push([]);e.push([]);d=0;for(n=j.length;d<n;d++){for(var i=j[d],q=i[0],r=false,c=0,p=s.length;c<p;c++)if(s[c].include(q)){e[c].push(i);r=true;
break}r||e[e.length-1].push(i)}var f;for(j=e.length-1;j>=0;j--){f=e[j];if(f.length>0)break}f=f[f.length-1];z.include(f[0])||(f[1]=f[1].valueOf()+"...");return e}function m(j){var e=[];h(j).each(function(d,n){e.push(g(n))});return e.join(" ")}var o=a.locale,u=a.qualifiers&&a.qualifiers[o]||{},y=a.explanations&&a.explanations[o]||{},s=a.groups||[],w=a.choices&&a.choices[o]||{},z=a.nonPartial||[];this.explanation=this.query=this.text="";this.contract=b;this.makeUpMissingFormat=k;this.rendered=g;this.groupify=
h;this.querify=function(j){var e=[],d,n;for(n in j){d=j[n][0];d=u[d]||d;e[n]=d+":"+j[n][2]}return e.join(" ")};this.suggestify=m;this.render=function(j){return m(j.combination)}};var PickyAllocationsCloud=function(a,b){var k=b.allocations,g=b.shownAllocations,h=b.showMoreAllocations,m=b.hiddenAllocations,o=b.maxSuggestions,u=function(){k.hide()},y=function(j){u();a.allocationChosen(j)},s=new AllocationRenderer(b),w=function(j){var e=[];j.each(function(d,n){var i=s.render(n),q=s.querify(n.combination);i=$('<li><div class="text">'+i+'</div><div class="count">'+n.count+"</div></li>");i.bind("click",{query:q},y);e.push(i)});return e},z=function(j){if(j.length==0)return k.hide();
g.empty();h.hide();m.empty().hide();if(j.length>o){$.each(j.slice(0,o-1),function(e,d){g.append(d)});$.each(j.slice(o-1),function(e,d){m.append(d)});h.show()}else $.each(j,function(e,d){g.append(d)});return k.show()};h.click(function(){h.hide();m.show()});this.hide=u;this.show=function(j){z(w(j.allocations));k.show()}};
