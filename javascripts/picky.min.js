Array.prototype.index=function(a){for(var c=0,h=this.length;c<h;c++)if(this[c]==a)return c;return null};Array.prototype.include=function(a){return this.index(a)!==null};Array.prototype.remove=function(a){this.splice(a,1);return this};Array.prototype.compare=function(a){return this.join("")==a.join("")};Array.prototype.each=function(a){for(var c=0,h=this.length;c<h;c++)a(c,this[c]);return this};var dictionary={common:{join:{de:"und",fr:"et",it:"e",en:"and",ch:"und"},"with":{de:"mit",fr:"avec",it:"con",en:"with",ch:"mit"},of:{de:"von",fr:"de",it:"di",en:"of",ch:"vo"},to:{de:"bis",fr:"\u00e0",it:"alla",en:"to",ch:"bis"}},results:{addination:{more:{de:"Weitere Resultate",fr:"Autres r\u00e9sultats",it:"Altri risultati",en:"More results",ch:"Mee Resultaat"}},header:{de:"Ergebnisse",fr:"R\u00e9sultats",it:"Risultati",en:"Results",ch:"Erg\u00e4bnis"}}},t=function(a){for(var c=PickyI18n.locale||
"en",h=a.split(".").concat(c),f=dictionary,e=0,m=h.length;e<m;e++){f=f[h[e]];if(f==undefined){f="Translation missing: "+a+"."+c;break}}return f};function Allocation(a,c,h,f,e,m){var o=this;this.type=a;this.weight=c;this.count=h;this.combination=f;this.ids=e||[];this.entries=this.rendered=m;this.isType=function(r){return r==o.type}}function Allocations(a){this.allocations=[];for(var c=0,h=a.length;c<h;c++){var f=a[c];this.allocations.push(new Allocation(f[0],f[1],f[2],f[3],f[4],f[5]))}this.length=this.allocations.length;this.each=function(e){return this.allocations.each(e)}}
function PickyData(a){var c=a.total,h=a.duration,f=a.offset,e=new Allocations(a.allocations||[]);this.original_hash=a;this.total=c;this.duration=h;this.offset=f;this.allocations=e;this.renderedAmount=function(){var m=0;e.each(function(o,r){m+=r.rendered.length});return m};this.isEmpty=function(){return c==0}};var PickyView=function(a,c){var h=c.showResultsLimit||10,f=c.input,e=c.reset,m=c.button,o=c.counter,r=c.dashboard,u=c.moreSelector,x=c.results,w=c.noResults,j=new PickyAddination(this,x),q=new PickyAllocationsCloud(this,c),d=new PickyResultsRenderer(j,c),i=function(){e.fadeTo(166,1)},g=function(){q.hide();x.empty();w.hide()},p=function(k){f.val(k);e.fadeTo(166,0);v("empty");o.empty();g()},b=function(){return f.val()};this.text=b;var n=function(k){o.text(k);k>0&&k<=5&&o.fadeTo("fast",0.5).fadeTo("fast",
1)},s=function(k){if(k.isEmpty())return"none";if(k.total>h&&k.allocations.length>1)return"support";return"ok"},v=function(k){r.attr("class","dashboard "+k)};this.insert=function(k){f.val(k);f.select()};this.fullResultsCallback=function(k){v(s(k));if(k.isEmpty()){g();n(0);w.show();i()}else if(k.total>h&&k.allocations.length>1){g();i();q.show(k);n(k.total)}else if(k.offset==0){g();n(k.total);d.render(k);x.show();i();f.focus()}else{var y=$(u).position().top;j.remove();d.render(k);$("body").animate({scrollTop:y-
12},500)}};this.liveResultsCallback=function(k){v(s(k));n(k.total)};this.allocationChosen=function(k){k=k.data.query;f.val(k);a.allocationChosen(k)};this.addinationClicked=function(k){a.addinationClicked(b(),k)};(function(){f.keyup(function(k){if(b()==""){p();a.searchTextCleared()}else{a.searchTextEntered(b(),k);i()}});o.click(function(){b()==""||a.searchButtonClicked(b())});m.click(function(){b()==""||a.searchButtonClicked(b())});e.click(function(){p("");a.clearButtonClicked();f.focus()})})();f.focus()};var PickyBackend=function(a){var c=function(h,f,e){var m=e||{};m=$.extend({query:h},e);$.getJSON(a,m,function(o){f&&f(new PickyData(o))})};this.search=function(h,f,e,m){c(h,function(o){f&&f(m,o)},e)}},LiveBackend=function(a){var c=a.live||alert("A live backend path must be provided."),h=new PickyBackend(c);this.search=function(f,e,m,o){o=o||{};latestRequestTimestamp=new Date;o.live=latestRequestTimestamp;m=$.extend({ids:a.liveResults||0,offset:0},m);h.search(f,function(r,u){if(!r.live||r.live==latestRequestTimestamp)e&&
e(u)},m,o)}},FullBackend=function(a){var c=a.full||alert("A full backend path must be provided."),h=new PickyBackend(c);this.search=function(f,e,m,o){o=o||{};latestRequestTimestamp=new Date;o.full=latestRequestTimestamp;m=$.extend({ids:a.fullResults||20,offset:0},m);h.search(f,function(r,u){if(!r.full||r.full==latestRequestTimestamp)e&&e(u)},m,o)}};var PickyController=function(a){var c=new PickyView(this,a),h=a.backends,f=a.before||function(){},e=a.success||function(){},m=a.after||function(){},o=a.liveRendered||false,r=a.liveSearchInterval||180,u,x=function(b){return(b=b&&b.match(/q=([^&]+)/))&&decodeURIComponent(b[1]).replace(/\+/g," ").replace(/#/g,"")||""};this.extractQuery=x;var w=function(){var b=window.History&&window.History.getState();return x(b&&b.url)};this.lastFullQuery=w;var j=function(b,n,s,v){u=[b,n,s,v];n=f(n,v)||n;(b=h[b])&&
b.search(n,s,v)};this.resend=function(){u&&j.apply(this,u)};var q=function(b,n){b=e(b,n)||b;c.fullResultsCallback(b);m(b,n)},d=function(b,n){clearInterval(g);if(b!=w()){var s="?q="+escape(b).replace(/\*/g,"%2A");window.History&&window.History.getState()&&window.History.pushState&&window.History.pushState(null,null,s)}j("full",b,q,n||{})};a=function(b,n){b=e(b,n)||b;c.liveResultsCallback(b);m(b,n)};var i=o?q:a,g,p=function(){var b=c.text();j("live",b,i,{});clearInterval(g)};g=setInterval(p,r);clearInterval(g);
this.insert=function(b,n,s){c.insert(b);s&&d(b,n)};this.clearButtonClicked=function(){clearInterval(g)};this.searchTextCleared=function(){clearInterval(g)};this.searchTextEntered=function(b,n){if($.inArray(n.keyCode,[0,8,13,32,46,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90])>-1)if(n.keyCode==13)d(b);else{clearInterval(g);g=setInterval(p,r)}};this.searchButtonClicked=function(b){d(b)};this.allocationChosen=function(b){d(b)};this.addinationClicked=
function(b,n){d(b,{offset:n.data.offset})}};var Localization={},PickyI18n={};$(function(){PickyI18n.locale=$("html").attr("lang").split("-")[0]||"en"});
var PickyClient=function(a){Localization.qualifiers=a.qualifiers||{};Localization.explanations=a.explanations||{};Localization.choices=a.choices||{};Localization.explanation_delimiters={de:"und",fr:"et",it:"e",en:"and",ch:"und"};var c=a.backends;if(c){c.live||alert("Both a full and live backend must be provided.");c.full||alert("Both a full and live backend must be provided.")}else a.backends={live:new LiveBackend(a),full:new FullBackend(a)};c=a.enclosingSelector||"#picky";a.input=$(a.inputSelector||
c+" input.query");a.reset=$(a.resetSelector||c+" div.reset");a.button=$(a.buttonSelector||c+" input.search_button");a.counter=$(a.counterSelector||c+" div.status");a.dashboard=$(a.dashboardSelector||c+" .dashboard");a.results=$(a.resultsSelector||c+" div.results");a.noResults=$(a.noResultsSelector||c+" .no_results");a.moreSelector=a.moreSelector||c+" div.results div.addination:last";a.allocations=$(a.allocationsSelector||c+" .allocations");a.shownAllocations=a.allocations.find(".shown");a.showMoreAllocations=
a.allocations.find(".more");a.hiddenAllocations=a.allocations.find(".hidden");a.maxSuggestions=a.maxSuggestions||3;a.results=$(a.resultsSelector||c+" div.results");a.resultsDivider=a.resultsDivider||"";a.noAsterisks=a.noAsterisks||[];a.wrapResults=a.wrapResults||'<ol class="results"></ol>';var h=a.controller&&new a.controller(a)||new PickyController(a);var f=this.insert=function(e,m,o){h.insert(e,m||{},o||true)};this.resend=h.resend;this.insertFromURL=function(e){if(e&&e!="")f(e);else(e=h.lastFullQuery())&&
f(e)};window.History&&window.History.Adapter.bind(window,"statechange",function(){var e=window.History.getState();(e=h.extractQuery(e.url))&&f(e)})};var PickyAddination=function(a,c){this.remove=function(){c.find(".addination").remove()};this.render=function(h){var f=h.total,e,m=h.renderedAmount();e=h.offset+m;m=e+m;h=h.total;if(h<m)m=h;e={offset:e,start:e+1,end:m};if(e.offset<f){f=$("<div class='addination'>"+t("results.addination.more")+"</div>");f.bind("click",{offset:e.offset},a.addinationClicked);return f}else return""}};var PickyResultsRenderer=function(a,c){var h=c.results,f=c.resultsDivider,e=c.wrapResults,m=c.noAsterisks,o=function(j){var q=j[j.length-1];j=j.slice(0,j.length-1);if(j==[])j=[j];if(!m.include(q[0]))if(q[1].match(/[^\*~]$/))q[1]+="*";j.push(q);return j},r=function(j){for(var q=Localization.explanations&&Localization.explanations[PickyI18n.locale]||{},d=[],i,g=0,p=j.length;g<p;g++){i=j[g];var b=i[0];b=q[b]||b;d.push([b,i[1]])}return d},u=function(j,q){return[j.replace(/([\w\s\u00c4\u00e4\u00d6\u00f6\u00dc\u00fc\u00e9\u00e8\u00e0]+)/,
"<strong>$1</strong>"),q].join(" ")},x=function(j,q){var d=Localization.explanation_delimiters[PickyI18n.locale],i=r(o(q)),g="",p=[];i=$.map(i,function(b){var n=b[0];b=b[1];if(g==""||n==g){b=b.replace(/[\w,]+:(.+)/,"$1");p.push(b);g=n}else{var s=u(g,p.join(" "));p=[];p.push(b);g=n;return s}});i.push(u(g,p.join(" ")));i=i.join(" "+d+" ");return'<span class="explanation">'+j+" "+i+"</span>"},w=function(j,q){var d='<div class="header">';d+=x(q.type,q.combination);if(j.offset>0)d+='<div class="tothetop"><a href="#" onclick="javascript:$(\'body\').animate({scrollTop: 0}, 500);">&uarr;</a></div>';
return d};this.render=function(j){j.allocations.each(function(q,d){if(d.entries.length>0){h.append(w(j,d)).append(d.entries.join(f));h.children("li").wrapAll(e)}});h.append(a.render(j))}};function AllocationRenderer(a,c){function h(d){var i={},g={},p=[],b;b=0;for(l=d.length;b<l;b++){var n=d[b][0];if(n in i){i[n]=i[n]+" "+d[b][1];p.push(b)}else{i[n]=d[b][1];g[b]=n}}for(b in g)d[b][1]=i[g[b]];for(b=p.length-1;b>=0;b--)d.remove(p[b]);return d}function f(d){return $.map(d,function(i,g){return"%"+(g+1)+"$s"}).join(" ")}function e(d){if(d.length==0)return"";var i=d=h(d);i.sort(function(y,z){return y[0]<z[0]?-1:1});for(var g=[],p=0,b=i.length;p<b;p++)g.push(i[p][0]);var n=g.length==1,s=j[g]||
(j[g]=f(g));if($.type(s)==="string"){j[g]={format:s};s=j[g]}var v=1,k=s.format;$.each(d,function(y,z){var A=z[0],B=z[2];if(s.filter)B=s.filter(B);A=x[A]||A;if(n&&!(s&&s.ignoreSingle))return k=B+"&nbsp;("+A+")";k=k.replace(RegExp("%"+v+"\\$s","g"),B);v+=1;return v});return k}function m(d){for(var i=[],g=0,p=w.length;g<p;g++)i.push([]);i.push([]);g=0;for(p=d.length;g<p;g++){for(var b=d[g],n=b[0],s=false,v=0,k=w.length;v<k;v++)if(w[v].include(n)){i[v].push(b);s=true;break}s||i[i.length-1].push(b)}var y;
for(d=i.length-1;d>=0;d--){y=i[d];if(y.length>0)break}y=y[y.length-1];q.include(y[0])||(y[1]+="...");return $.map(i,function(z){return e(z)})}function o(d){var i=[],g,p;for(p in d){g=d[p][0];g=u[g]||g;i[p]=g+":"+d[p][2]}return i.join(" ")}var r=PickyI18n.locale,u=Localization.qualifiers&&Localization.qualifiers[r]||{},x=Localization.explanations&&Localization.explanations[r]||{},w=c.groups||[],j=Localization.choices&&Localization.choices[r]||{};this.explanation=this.query=this.text="";var q=["street_number",
"zipcode"];this.contract=h;this.rendered=e;this.groupify=m;this.querify=o;this.render=function(d){var i=d.combination,g=d.count;d=o(i);i=m(i).join(" ");i=$('<li><div class="text">'+i+'</div><div class="count">'+g+"</div></li>");i.bind("click",{query:d},a);return i}};var PickyAllocationsCloud=function(a,c){var h=c.allocations,f=c.shownAllocations,e=c.showMoreAllocations,m=c.hiddenAllocations,o=c.maxSuggestions,r=function(){h.hide()},u=new AllocationRenderer(function(j){r();a.allocationChosen(j)},c),x=function(j){var q=[];j.each(function(d,i){q.push(u.render(i))});return q},w=function(j){if(j.length==0)return h.hide();f.empty();e.hide();m.empty().hide();if(j.length>o){$.each(j.slice(0,o-1),function(q,d){f.append(d)});$.each(j.slice(o-1),function(q,d){m.append(d)});
e.show()}else $.each(j,function(q,d){f.append(d)});return h.show()};e.click(function(){e.hide();m.show()});this.hide=r;this.show=function(j){w(x(j.allocations));h.show()}};
